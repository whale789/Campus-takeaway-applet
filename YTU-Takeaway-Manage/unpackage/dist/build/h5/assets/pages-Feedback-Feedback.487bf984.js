import{o as t,c as a,w as e,d as s,n as i,a as l,F as n,r,b as d,e as o,t as c,h as u,p as h,q as g,f as p,k as _,i as m,D as f,g as b,j as v}from"./index-745be673.js";import{_ as k}from"./_plugin-vue_export-helper.1b428a4d.js";import{r as y}from"./uni-app.es.4a269a07.js";const x=k({name:"UniListChat",emits:["click"],props:{title:{type:String,default:""},note:{type:String,default:""},clickable:{type:Boolean,default:!1},link:{type:[Boolean,String],default:!1},to:{type:String,default:""},badgeText:{type:[String,Number],default:""},badgePositon:{type:String,default:"right"},time:{type:String,default:""},avatarCircle:{type:Boolean,default:!1},avatar:{type:String,default:""},avatarList:{type:Array,default:()=>[]}},computed:{isSingle(){if("dot"===this.badgeText)return"uni-badge--dot";return this.badgeText.toString().length>1?"uni-badge--complex":"uni-badge--single"},computedAvatar(){return this.avatarList.length>4?(this.imageWidth=13.95,"avatarItem--3"):this.avatarList.length>1?(this.imageWidth=21.15,"avatarItem--2"):(this.imageWidth=45,"avatarItem--1")}},data:()=>({isFirstChild:!1,border:!0,imageWidth:50}),mounted(){this.list=this.getForm(),this.list&&(this.list.firstChildAppend||(this.list.firstChildAppend=!0,this.isFirstChild=!0),this.border=this.list.border)},methods:{getForm(t="uniList"){let a=this.$parent,e=a.$options.name;for(;e!==t;){if(a=a.$parent,!a)return!1;e=a.$options.name}return a},onClick(){""===this.to?(this.clickable||this.link)&&this.$emit("click",{data:{}}):this.openPage()},openPage(){-1!==["navigateTo","redirectTo","reLaunch","switchTab"].indexOf(this.link)?this.pageApi(this.link):this.pageApi("navigateTo")},pageApi(t){uni[t]({url:this.to,success:t=>{this.$emit("click",{data:t})},fail:t=>{this.$emit("click",{data:t}),console.error(t.errMsg)}})}}},[["render",function(f,b,v,k,y,x){const C=p,M=_,L=m;return t(),a(C,{"hover-class":v.clickable||v.link?"uni-list-chat--hover":"",class:"uni-list-chat",onClick:g(x.onClick,["stop"])},{default:e((()=>[s(C,{class:i({"uni-list--border":y.border,"uni-list-chat--first":y.isFirstChild})},null,8,["class"]),s(C,{class:"uni-list-chat__container"},{default:e((()=>[s(C,{class:"uni-list-chat__header-warp"},{default:e((()=>[v.avatarCircle||0===v.avatarList.length?(t(),a(C,{key:0,class:i(["uni-list-chat__header",{"header--circle":v.avatarCircle}])},{default:e((()=>[s(M,{class:i(["uni-list-chat__header-image",{"header--circle":v.avatarCircle}]),src:v.avatar,mode:"aspectFill"},null,8,["class","src"])])),_:1},8,["class"])):(t(),a(C,{key:1,class:"uni-list-chat__header"},{default:e((()=>[(t(!0),l(n,null,r(v.avatarList,((l,n)=>(t(),a(C,{key:n,class:i(["uni-list-chat__header-box",x.computedAvatar]),style:d({width:y.imageWidth+"px",height:y.imageWidth+"px"})},{default:e((()=>[s(M,{class:"uni-list-chat__header-image",style:d({width:y.imageWidth+"px",height:y.imageWidth+"px"}),src:l.url,mode:"aspectFill"},null,8,["style","src"])])),_:2},1032,["class","style"])))),128))])),_:1}))])),_:1}),v.badgeText&&"left"===v.badgePositon?(t(),a(C,{key:0,class:i(["uni-list-chat__badge uni-list-chat__badge-pos",[x.isSingle]])},{default:e((()=>[s(L,{class:"uni-list-chat__badge-text"},{default:e((()=>[o(c("dot"===v.badgeText?"":v.badgeText),1)])),_:1})])),_:1},8,["class"])):u("",!0),s(C,{class:"uni-list-chat__content"},{default:e((()=>[s(C,{class:"uni-list-chat__content-main"},{default:e((()=>[s(L,{class:"uni-list-chat__content-title uni-ellipsis"},{default:e((()=>[o(c(v.title),1)])),_:1}),s(L,{class:"uni-list-chat__content-note uni-ellipsis"},{default:e((()=>[o(c(v.note),1)])),_:1})])),_:1}),s(C,{class:"uni-list-chat__content-extra"},{default:e((()=>[h(f.$slots,"default",{},(()=>[s(L,{class:"uni-list-chat__content-extra-text"},{default:e((()=>[o(c(v.time),1)])),_:1}),v.badgeText&&"right"===v.badgePositon?(t(),a(C,{key:0,class:i(["uni-list-chat__badge",[x.isSingle,"right"===v.badgePositon?"uni-list-chat--right":""]])},{default:e((()=>[s(L,{class:"uni-list-chat__badge-text"},{default:e((()=>[o(c("dot"===v.badgeText?"":v.badgeText),1)])),_:1})])),_:1},8,["class"])):u("",!0)]),!0)])),_:3})])),_:3})])),_:3})])),_:3},8,["hover-class","onClick"])}],["__scopeId","data-v-0b029afc"]]);const C=k({name:"uniList","mp-weixin":{options:{multipleSlots:!1}},props:{enableBackToTop:{type:[Boolean,String],default:!1},scrollY:{type:[Boolean,String],default:!1},border:{type:Boolean,default:!0}},created(){this.firstChildAppend=!1},methods:{loadMore(t){this.$emit("scrolltolower")}}},[["render",function(s,i,l,n,r,d){const o=p;return t(),a(o,{class:"uni-list uni-border-top-bottom"},{default:e((()=>[l.border?(t(),a(o,{key:0,class:"uni-list--border-top"})):u("",!0),h(s.$slots,"default",{},void 0,!0),l.border?(t(),a(o,{key:1,class:"uni-list--border-bottom"})):u("",!0)])),_:3})}],["__scopeId","data-v-a351b006"]]);const M=k({data:()=>({Account:0,ManagerId:"",MsgList:[]}),onShow(){this.Account=2640055850003,f.callFunction({name:"GetManagerMsg",data:{Account:this.Account}}).then((t=>{this.ManagerId=t.result.data[0]._id,console.log(this.ManagerId),f.callFunction({name:"GetChatByManagerId",data:{ManagerId:this.ManagerId}}).then((t=>{for(var a=0;a<t.result.data.length;a++){for(var e=0,s=t.result.data[a].MsgList.length,i=0;i<s;i++)0==t.result.data[a].MsgList[i].MessageState&&e++;t.result.data[a].NotReadNum=e,""==t.result.data[a].MsgList[s-1].botContent?t.result.data[a].LastMessage=t.result.data[a].MsgList[s-1].userContent:t.result.data[a].LastMessage=t.result.data[a].MsgList[s-1].botContent,t.result.data[a].LastTime=t.result.data[a].MsgList[s-1].MessageTime}this.MsgList=t.result.data}))}))},methods:{GoToChatDetail(t){b({url:"/pages/ChatDetail/ChatDetail?ChatId="+t})}}},[["render",function(i,d,o,c,u,h){const g=y(v("uni-list-chat"),x),_=y(v("uni-list"),C),m=p;return t(),a(m,null,{default:e((()=>[s(m,null,{default:e((()=>[(t(!0),l(n,null,r(u.MsgList,((i,l)=>(t(),a(_,{border:!0,key:l},{default:e((()=>[s(g,{"avatar-circle":!0,title:i.UserNickName,avatar:i.UserAvatar,note:i.LastMessage,time:i.LastTime,"badge-text":i.NotReadNum,clickable:"true",onClick:t=>h.GoToChatDetail(i._id)},null,8,["title","avatar","note","time","badge-text","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})}]]);export{M as default};
